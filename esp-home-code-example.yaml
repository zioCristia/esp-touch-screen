esphome:
  name: display-crow
  friendly_name: display-crow
  platformio_options:
    build_flags: "-DBOARD_HAS_PSRAM"
    board_build.esp-idf.memory_type: qio_opi
    board_build.flash_mode: dio

esp32:
  board: esp32s3box
  framework:
    type: esp-idf
    #version: recommended
    sdkconfig_options:
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: y
      CONFIG_ESP32S3_DATA_CACHE_64KB: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y

psram:
  mode: octal
  speed: 80MHz

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret encryption_key
  # to visualize connection status
  on_client_connected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - lvgl.widget.show: lbl_hastatus
  on_client_disconnected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - lvgl.widget.hide: lbl_hastatus

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Display-Crow Fallback Hotspot"
    password: "oYGfWuiq8UNI"

captive_portal:

output:
  - platform: ledc
    pin: 2
    frequency: 1220
    id: gpio_backlight_pwm

i2c:
  sda: GPIO19
  scl: GPIO20
  scan: true

light:
  - platform: monochromatic
    output: gpio_backlight_pwm
    name: Display Backlight
    id: display_backlight
    restore_mode: ALWAYS_ON

touchscreen:
  platform: gt911
  on_release: # to trigger the turn off display when idle
      - if:
          condition: lvgl.is_paused
          then:
            - logger.log: "LVGL resuming"
            - switch.turn_off: switch_antiburn
            - lvgl.resume:
            - lvgl.widget.redraw:
            - light.turn_on: display_backlight

number:
  - platform: template
    name: LVGL Screen timeout
    optimistic: true
    id: display_timeout
    unit_of_measurement: "s"
    initial_value: 45
    restore_value: true
    min_value: 10
    max_value: 180
    step: 5
    mode: box

time:
  - platform: homeassistant
    on_time:
      - hours: 2,3,4,5,6
        minutes: 5
        seconds: 0
        then:
          - switch.turn_on: switch_antiburn
      - hours: 2,3,4,5,6
        minutes: 35
        seconds: 0
        then:
          - switch.turn_off: switch_antiburn

switch:
  - platform: template
    name: Antiburn
    id: switch_antiburn
    icon: mdi:television-shimmer
    optimistic: true
    entity_category: "config"
    turn_on_action:
      - logger.log: "Starting Antiburn"
      - if:
          condition: lvgl.is_paused
          then:
            - lvgl.resume:
            - lvgl.widget.redraw:
      - lvgl.pause:
          show_snow: true
    turn_off_action:
      - logger.log: "Stopping Antiburn"
      - if:
          condition: lvgl.is_paused
          then:
            - lvgl.resume:
            - lvgl.widget.redraw:

binary_sensor:
  - platform: homeassistant
    id: cancello
    entity_id: switch.cancello
    publish_initial_state: true
    on_state:
      then:
        lvgl.widget.update:
          id: cancello_btn
          state:
            checked: !lambda return x;

sensor:
  # Sensori energia
  - platform: homeassistant
    id: potenza_impianto_fotovoltaico
    entity_id: sensor.potenza_impianto_fotovoltaico
    on_value:
      then:
        lvgl.label.update:
          id: solar_power
          text:
            format: "%.0f W"
            args: [ 'x' ]
  - platform: homeassistant
    id: potenza_casa
    entity_id: sensor.potenza_casa
    on_value:
      then:
        lvgl.label.update:
          id: house_power
          text:
            format: "%.0f W"
            args: [ 'x' ]
  - platform: homeassistant
    id: differenza_potenza
    entity_id: sensor.differenza_potenza
    on_value:
      then:
        lvgl.label.update:
          id: power_difference
          text:
            format: "%.0f W"
            args: [ 'x' ]
  - platform: homeassistant
    id: potenza_condizionatori
    entity_id: sensor.potenza_condizionatori
    on_value:
      then:
        lvgl.label.update:
          id: ac_power
          text:
            format: "%.0f W"
            args: [ 'x' ]
  - platform: homeassistant
    id: potenza_casa_senza_ac
    entity_id: sensor.potenza_casa_senza_ac
    on_value:
      then:
        lvgl.label.update:
          id: house_without_ac
          text:
            format: "%.0f W"
            args: [ 'x' ]
  # Humidity and temperature sensors
  - platform: homeassistant
    id: temperatura_sala_sotto
    entity_id: sensor.temperatura_sala_sotto
    on_value:
      then:
        lvgl.label.update:
          id: living_room_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_soggiorno
    entity_id: sensor.temperatura_soggiorno
    on_value:
      then:
        lvgl.label.update:
          id: dining_room_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_bagno_sotto
    entity_id: sensor.temperatura_bagno_sotto
    on_value:
      then:
        lvgl.label.update:
          id: bathroom_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_sala_sopra
    entity_id: sensor.temperatura_sala_sopra
    on_value:
      then:
        lvgl.label.update:
          id: upstairs_living_room_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_camera
    entity_id: sensor.temperatura_camera
    on_value:
      then:
        lvgl.label.update:
          id: bedroom_1_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_camera_2
    entity_id: sensor.temperatura_camera_2
    on_value:
      then:
        lvgl.label.update:
          id: bedroom_2_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_bagno_sopra
    entity_id: sensor.temperatura_bagno_sopra
    on_value:
      then:
        lvgl.label.update:
          id: bathroom_1_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: temperatura_bagno_camera
    entity_id: sensor.temperatura_bagno_camera
    on_value:
      then:
        lvgl.label.update:
          id: bathroom_2_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]

display:
  - platform: rpi_dpi_rgb
    id: main_display
    color_order: RGB
    invert_colors: True
    update_interval: 5s
    auto_clear_enabled: false
    dimensions:
      width: 800
      height: 480
    de_pin: 40
    hsync_pin: 39
    vsync_pin: 41
    pclk_pin: 0
    pclk_frequency: 12MHz
    data_pins:
      red:
        - 45        #r1
        - 48        #r2
        - 47        #r3
        - 21        #r4
        - 14        #r5
      green:
        - 5         #g0
        - 6         #g1
        - 7         #g2
        - 15        #g3
        - 16        #g4
        - 4         #g5
      blue:
        - 8         #b1
        - 3         #b2
        - 46        #b3
        - 9         #b4
        - 1         #b5

image:
  - file: mdi:thermometer
    id: thermometer
    type: binary
    resize: 50x50
  - file: mdi:gate
    id: gate
    type: binary
    resize: 50x50

globals:
  - id: target_temp_set_room
    type: float
    restore_value: yes
    initial_value: '18.0'

lvgl:
  color_depth: 16
  bg_color: 0
  border_width: 0
  outline_width: 0
  shadow_width: 0
  text_font: unscii_16
  align: center
  on_idle:  # turn off screen when idle
    timeout: !lambda "return (id(display_timeout).state * 1000);"
    then:
      - logger.log: "LVGL is idle"
      - light.turn_off: display_backlight
      - switch.turn_on: switch_antiburn
      - lvgl.pause:
  theme:
    label:
      text_font: montserrat_34 # set all your labels to use your custom defined font
    button:
      bg_color: 0x2F8CD8
      bg_grad_color: 0x005782
      bg_grad_dir: VER
      bg_opa: COVER
      border_color: 0x0077b3
      border_width: 1
      text_color: 0xFFFFFF
      pressed: # set some button colors to be different in pressed state
        bg_color: 0x006699
        bg_grad_color: 0x00334d
      checked: # set some button colors to be different in checked state
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        text_color: 0xfff300
    buttonmatrix:
      bg_opa: TRANSP
      border_color: 0x0077b3
      border_width: 0
      text_color: 0xFFFFFF
      pad_all: 0
      items: # set all your buttonmatrix buttons to use your custom defined styles and font
        bg_color: 0x2F8CD8
        bg_grad_color: 0x005782
        bg_grad_dir: VER
        bg_opa: COVER
        border_color: 0x0077b3
        border_width: 1
        text_color: 0xFFFFFF
        text_font: montserrat_8
        pressed:
          bg_color: 0x006699
          bg_grad_color: 0x00334d
        checked:
          bg_color: 0x1d5f96
          bg_grad_color: 0x03324A
          text_color: 0x005580
    switch:
      bg_color: 0xC0C0C0
      bg_grad_color: 0xb0b0b0
      bg_grad_dir: VER
      bg_opa: COVER
      checked:
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        bg_grad_dir: VER
        bg_opa: COVER
      knob:
        bg_color: 0xFFFFFF
        bg_grad_color: 0xC0C0C0
        bg_grad_dir: VER
        bg_opa: COVER
  style_definitions:
    - id: header_footer
      bg_color: 0x2F8CD8
      bg_grad_color: 0x005782
      bg_grad_dir: VER
      bg_opa: COVER
      border_opa: TRANSP
      radius: 0
      pad_all: 0
      pad_row: 0
      pad_column: 0
      border_color: 0x0077b3
      text_color: 0xFFFFFF
      text_font: montserrat_28
      width: 100%
      height: 30
  top_layer:
    widgets:
      - buttonmatrix:
            align: bottom_mid
            styles: header_footer
            pad_all: 0
            outline_width: 0
            id: top_layer
            items:
              styles: header_footer
            rows:
              - buttons:
                - id: page_energy
                  text: "\uF015"
                  on_press:
                    then:
                      lvgl.page.show: energy_page
                - id: page_temp_1
                  text: "T sotto"
                  on_press:
                    then:
                      lvgl.page.show: temp_1_page
                - id: page_temp_2
                  text: "T sopra"
                  on_press:
                    then:
                      lvgl.page.show: temp_2_page
      - label:
          text: "\uF1EB"
          id: lbl_hastatus
          hidden: true
          align: top_right
          x: -2
          y: 3
          text_align: right
          text_color: 0xFFFFFF
          text_font: montserrat_24

  pages:
    - id: energy_page
      widgets:
        - obj:
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "Energia casa"
                  text_font: montserrat_28
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF
        - obj:
            align: CENTER
            width: 100%
            height: 420px
            pad_all: 6
            text_align: CENTER
            layout: # enable the GRID layout for the children widgets
              type: GRID # split the rows and the columns proportionally
              grid_columns: [FR(1), FR(1), FR(1)] # equal
              grid_rows: [FR(10), FR(50), FR(10), FR(30)] # like percents
            widgets:
              - label:
                  text: "Fotovoltaico"
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 0 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: solar_power
                  text: "1000 W"
                  text_font: montserrat_48
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 1 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  text: "Casa"
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 0 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: house_power
                  text: "1000 W"
                  text_font: montserrat_48
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 1 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  align: center
              - label:
                  text: "Diff"
                  grid_cell_column_pos: 2 # place the widget in
                  grid_cell_row_pos: 0 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: power_difference
                  text: "-1300 W"
                  text_font: montserrat_48
                  grid_cell_column_pos: 2 # place the widget in
                  grid_cell_row_pos: 1 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  align: center
              - label:
                  text: "Condizionatori"
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: ac_power
                  text: "0 W"
                  text_font: montserrat_48
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 3 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  text: "Casa senza cond."
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: house_without_ac
                  text: "1000 W"
                  text_font: montserrat_48
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 3 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - button:
                  id: cancello_btn
                  align: CENTER
                  checkable: true
                  grid_cell_column_pos: 2 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_row_span: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - image:
                        src: gate
                        pad_all: 2
                  on_click:
                    - homeassistant.action:
                        action: switch.toggle
                        data:
                          entity_id: switch.cancello

    - id: temp_1_page
      widgets:
        - obj:  # Header
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "Temperature piano sotto"
                  text_font: montserrat_28
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF
        - obj:
            align: CENTER
            width: 100%
            height: 420px
            pad_all: 6
            layout: # enable the GRID layout for the children widgets
              type: GRID # split the rows and the columns proportionally
              grid_columns: [FR(1), FR(1), FR(1)] # equal
              grid_rows: [FR(10), FR(50)] # like percents
            widgets:
              - obj:  # Sala
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  grid_cell_row_span: 2
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN_WRAP # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Sala"
                        pad_bottom: 1
                    - obj:  # Sala temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: living_room_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Sala temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_2
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_2
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_2
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
              - obj:  # Soggiorno
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  grid_cell_row_span: 2
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN_WRAP # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Soggiorno"
                        pad_bottom: 1
                    - obj:  # Soggiorno temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: dining_room_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_3
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_3
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Soggiorno temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_3
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_3
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_3
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
              - obj:  # Bagno sotto
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  grid_cell_row_span: 2
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN_WRAP # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Bagno sotto"
                        pad_bottom: 1
                    - obj:  # Bagno sotto temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: bathroom_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_4
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_4
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Bagno sotto temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_4
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_4
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_3
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
                              
    - id: temp_2_page
      widgets:
        - obj:  # Header
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "Temperature piano sopra"
                  text_font: montserrat_28
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF
        - obj:
            align: CENTER
            width: 100%
            height: 420px
            pad_all: 6
            layout: # enable the GRID layout for the children widgets
              type: GRID # split the rows and the columns proportionally
              grid_columns: [FR(1), FR(1), FR(1)] # equal
              grid_rows: [FR(1), FR(1)] # like percents
            widgets:
              - obj:  # Sala sopra
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Sala sopra"
                        pad_bottom: 1
                    - obj:  # Sala sopra temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: upstairs_living_room_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_5
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_5
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Sala sopra temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_5
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_5
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_5
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
              - obj:  # Bagno sopra
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Bagno sopra"
                        pad_bottom: 1
                    - obj:  # Bagno sopra temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: bathroom_1_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_6
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_6
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Bagno sopra temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_6
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_6
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_6
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
              - obj:  # Camera 2
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Camera 2"
                        pad_bottom: 1
                    - obj:  # Camera 2 temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: bedroom_2_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_7
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_7
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Camera 2 temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_7
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_7
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_7
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"
              
              - obj:  # Camera 1
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Camera 1"
                        pad_bottom: 1
                    - obj:  # Camera 1 temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: bedroom_1_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_8
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_8
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Camera 1 temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_8
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_8
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_8
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"         
              - obj:  # Bagno camera
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pad_all: 4
                  pad_bottom: 2
                  pad_top: 2
                  align: CENTER
                  width: 100%
                  layout: # enable the FLEX layout for the children widgets
                    type: FLEX
                    flex_flow: COLUMN # the order of the widgets starts top left
                    flex_align_cross: CENTER # they sould be centered
                  widgets:
                    - label:
                        text: "Bagno camera"
                        pad_bottom: 1
                    - obj:  # Bagno camera temp stanza
                        pad_all: 0
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        widgets:
                          - image:
                              src: thermometer
                              pad_all: 2
                          - label:
                              id: bathroom_2_temp
                              text: "10°C"
                          - button:
                              id: thermostat_mode_automatic_button_9
                              pad_all: 5
                              widgets:
                                - label:
                                    id: thermostat_mode_automatic_label_9
                                    text_font: montserrat_24
                                    text: "M"
                    - obj:  # Bagno camera temp impostata
                        align: CENTER
                        pad_all: 1
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        border_opa: TRANSP
                        widgets:
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) - 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_9
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "-"
                          - label:
                              id: target_temp_set_room_label_9
                              text: "18.0°C"
                              align: CENTER
                              text_font: montserrat_26
                              pad_all: 2
                          - button:
                              on_click:
                                - lambda: |-
                                    id(target_temp_set_room) = id(target_temp_set_room) + 0.5;
                                - lvgl.label.update: 
                                    id: target_temp_set_room_label_9
                                    text:
                                      format: "%.1f°C"
                                      args: [ 'id(target_temp_set_room)' ]
                              widgets:
                                - label:
                                    text: "+"